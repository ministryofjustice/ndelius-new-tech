@import helpers.CallHelper.relative
@import org.webjars.play.WebJarsUtil
@import java.text.SimpleDateFormat
@this(webJarsUtil: WebJarsUtil)

@(feedbacks: List[Map[String, Object]], usernameExpression: String)

@df = @{new SimpleDateFormat("dd/MM/yyyy HH:mm")}

@display(feedback: Map[String, Object]) = {
  <tr>
    <td>@df.format(feedback.get("dateTime").asInstanceOf[Date])</td>
    <td>
      <p>@usernameExpression.r.findFirstMatchIn(feedback.get("username").toString).map(m => m.group(1)).getOrElse(feedback.get("username"))</p>
      <p>@feedback.get("feedback").asInstanceOf[Map[String, String]].get("email")</p>
    <td>
      <p>@feedback.get("feedback").asInstanceOf[Map[String, String]].get("role")</p>
      <p>@feedback.get("feedback").asInstanceOf[Map[String, String]].get("provider")</p>
      <p>@feedback.get("feedback").asInstanceOf[Map[String, String]].get("region")</p>
    </td>
    <td>@feedback.get("feedback").asInstanceOf[Map[String, String]].get("rating")</td>
    <td width="40%">@feedback.get("feedback").asInstanceOf[Map[String, String]].get("feedback")</td>
  </tr>
}

<!DOCTYPE html>
<html lang="en">
  <head>

    <title>HMPPS - National Search Feedback</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" media="screen" href='@relative(routes.Assets.versioned("stylesheets/govuk-elements-styles.css"))' />
    <link rel="shortcut icon" type="image/x-icon" href='@relative(routes.Assets.versioned("images/favicon.ico"))' />

    <style>
      table th, table td {
        border-bottom: 1px solid #bfc1c3 !important;
      }
    </style>
  </head>
  <body>
    <main id="content" style="max-width: 95%; width: 95%">

      <div class="phase-banner">
        <p><strong class="phase-tag">ALPHA</strong><span>This is a new service â€“ your <a href="javascript:void(0);" class="feedback-link" title="feedback">feedback</a> will help us to improve it.</span></p>
      </div>

      <h1 class="heading-xlarge">National Search Feedback</h1>

      <a href="../nationalSearch/satisfaction">Satisfaction counts</a>

      <table>
          <caption class="heading-small">Latest feedback</caption>
        <thead>
          <tr>
            <td>Submitted date</td>
            <td>Username / Email</td>
            <td>Role / Provider / Region</td>
            <td>Rating</td>
            <td>Additional comments</td>
          </tr>
        </thead>
        <tbody>
        @for(feedback <- feedbacks) {
          @display(feedback)
        }
        </tbody>
      </table>

    </main>
  </body>
  </html>
