@import data._
@import helper._
@import paroleParom1Report.hiddenInputs._
@import play.Environment
@import data.viewModel.PageStatus
@import org.webjars.play.WebJarsUtil
@import fragment.popup
@import com.typesafe.config.Config

@(reportForm: Form[ParoleParom1ReportData], encrypter: String => String)(implicit pageStatuses: Map[Int, PageStatus], webJarsUtil: WebJarsUtil, environment: Environment, configuration: Config)

@implicitField = @{
    FieldConstructor(govukElements.f)
}

@agenciesHint = {
    <ul class="govuk-list govuk-list--bullet govuk-!-margin-bottom-0">
        <li>Sentence details, relevant risk assessment scores (OGRS, OGP, OVP and RSR) and other specialist assessments such as RM2k, HCR-20, SARN and SARA.</li>
        <li>A summary of the RoSH scores for all victims and groups - include risk to self.</li>
        <li>A summary of the current circumstances linked to risk and engagement with other agencies when subject to MAPPA. This is pertinent for domestic or sexual abuse cases. For example, if you assess the prisoner as a RoSH to children be clear about their current and future contact with them.</li>
    </ul>
}

@supportHint = {
    <ul class="govuk-list govuk-list--bullet govuk-!-margin-bottom-0">
        <li>All agencies working with the prisoner, now and in the future - failure to account for all agencies will have a negative impact on the rest of the RMP.</li>
        <li>Agency and service contact names and details, if disclosable. Include the specific service of the supporting agency with time frames.</li>
        <li>Actions for agencies supporting MAPPA, if disclosable.</li>
        <li>Cases registered with the VCS and if the victims are participating - you must not disclose VLO name or details.</li>
    </ul>
}

@controlHint = {
    <ul class="govuk-list govuk-list--bullet govuk-!-margin-bottom-0">
        <li>Positive and protective factors that encourage social capital, for example, accredited programmes, faith groups, supportive family, support from partnership agencies or employment opportunities - these could be current or in development.</li>
        <li>Factors that manage the risk posed by the prisoner, for example, restrictive licence conditions or statutory requirements such as sexual harm prevention, violent offender or restraining orders.</li>
        <li>Consideration of how these factors will be used and what has worked in the past that could be used again.</li>
        <li>Information recorded under the correct heading, for example, support networks can encourage desistance (support) but would a partner be considered a support if there is an entrenched history of domestic abuse and a licence condition preventing contact (control)?</li>
        <li>Supporting explanation and analysis.</li>
    </ul>
}

@riskMeasuresHint = {
    <ul class="govuk-list govuk-list--bullet govuk-!-margin-bottom-0">
        <li>Activities and interventions designed to address specific risks, civil orders or requirements, for example, sexual harm prevention order, violent offender order, restraining order or sex offender registration. This section is different from Added conditions or requirements.</li>
        <li>What will be done to reduce risk - reflect this in sentence plan objectives and OASys section R10.</li>
        <li>Identification of all risks and the work to be done to address each one, in priority order. For example, for a domestic abuse risk, the activities to be undertaken are BBR, disclosure of new relationships licence condition and a restraining order.</li>
        <li>An account of victim concerns and those directly expressed by the victim or their family.</li>
        <li>An account of safeguarding concerns, for example, child protection registration and care and support plans.</li>
        <li>A reference to active checks and agency updates if domestic abuse or safeguarding are risks.</li>
        <li>Consideration of PD case formulations as they create hypotheses about facilitating change - these will guide interventions and their priorities.</li>
    </ul>
}

@agencyActionsHint = {
    <ul class="govuk-list govuk-list--bullet govuk-!-margin-bottom-0">
        <li>Agencies working with the prisoner, now and in the future.</li>
        <li>The work each agency is to doing and how it relates to reducing harm - include time frames.</li>
        <li>How these actions are being reviewed and reported, for example, to a person or via a review meeting.</li>
        <li>MAPPA review dates and actions, if relevant and disclosable.</li>
        <li>Clarification of the information to be provided to the VLO for cases registered with the VCS - include the time frame.</li>
        <li>Actions required by AP staff, if relevant.</li>
    </ul>
}

@additionalConditionsHint = {
    <ul class="govuk-list govuk-list--bullet govuk-!-margin-bottom-0">
        <li>Restrictions and conditions to manage risk, such as (indicative) additional licence conditions beyond the 6 standard conditions. This section is different to Added measures to manage specific risks.</li>
        <li>A full and specific account of the conditions, for example, a condition that relates to no contact with children should specify the age - 16 or 18. PPCS should approve bespoke conditions before the report is submitted.</li>
        <li>Conditions that are necessary and proportionate to manage the level of risk - the Parole Board require a full explanation. A request from another agency at a MAPPA meeting is not sufficient - you must explain the reasons for the request.</li>
        <li>VLO consultation on licence conditions to manage risk to the victim - this could include non-contact or exclusion zones. If an exclusion zone is requested, you must provide a clear map with supporting analysis, for example, exclusion from roads around and including the victim’s address to prevent distress.</li>
        <li>Clarification of who is responsible for enforcing conditions - include time frames.</li>
        <li>Pathway plans for children or young adults leaving care, if appropriate. These are a legal requirement and can last until the prisoner is 25.</li>
    </ul>
}

@levelOfContactHint = {
    <ul class="govuk-list govuk-list--bullet govuk-!-margin-bottom-0">
        <li>Clearly defined levels of contact - include timescales of office visits and home visits.</li>
        <li>A schedule of contact and consideration for a review period.</li>
        <li>Consideration of the evidence that the higher the likelihood of reoffending or harm, the higher the levels of contact should be.</li>
        <li>Consideration of home visits to provide information about risk issues.</li>
        <li>Clarification on the required level of contact with other agencies.</li>
    </ul>
}

@contingencyPlanHint = {
    <ul class="govuk-list govuk-list--bullet govuk-!-margin-bottom-0">
        <li>An account of the potential breakdown or change of all risk management interventions or supportive factors that you have mentioned. You must plan for all of the factors you have mentioned in the ‘Factors that may increase RoSH’ section and in OASys.</li>
        <li>Clearly defined contingency actions - in what circumstances they should happen, who is responsible for them and the time frame.</li>
        <li>Clearly defined actions for agencies involved.</li>
        <li>Clearly defined actions to protect known victims - only if they do not comprise their safety.</li>
        <li>If you consider a MARAC referral to be a necessary contingency describe them as ‘additional multi-agency involvement related to domestic abuse’. They are non-disclosable.</li>
        <li>Identification of what would constitute a standard or emergency recall, or where out of hours action would be required - be specific, a catch-all phrase such as ‘recall’ is not sufficient.</li>
        <li>Consideration for what an out of hours recall would like if the prisoner was in approved premises - include the safeguarding activity staff would need to take out of hours.</li>
        <li>The contact SPOC or lead for out hours actions.</li>
        <li>Consideration for PD pathway formulations concerning potential difficulties and how they can be overcome.</li>
    </ul>
}

@popup(reportForm, encrypter, "Risk Management Plan (RMP)", 16) {

    <div class="govuk-warning-text moj-warning-text">
        <span aria-hidden="true" class="govuk-warning-text__icon">!</span>
        <strong class="govuk-warning-text__text">
            <span class="govuk-warning-text__assistive">Warning</span>
            You must complete the RMP for all on or post-tariff prisoners, even if you are not supporting release or they are subject to deportation
        </strong>
    </div>

    <p class="govuk-caption-xl govuk-!-margin-top-0 govuk-!-margin-bottom-0">Detail the risk management plan (RMP)</p>

    <details class="govuk-details govuk-!-margin-top-0 govuk-!-margin-bottom-6 no-margin-top margin-bottom medium">
        <summary class="govuk-details__summary">
            <span class="govuk-details__summary-text">RMP guidance</span>
        </summary>
        <div class="govuk-details__text panel panel-border-narrow">

            <p>The community RMP must include what other agencies will do to manage the risk presented by the offender.</p>
            <p>Providing a custodial based RMP will not assist the Parole Board to make an informed decision about release.</p>
            <p>Failure to provide a community RMP when one is required could cause further delay to proceedings and the prisoner pursuing action.</p>
            <p>The accompanying OASys can detail both a custodial and community RMP.</p>
            <p>For those on or post-tariff your report must consider the Parole Board’s statutory release test: ‘that it is no longer necessary for the protection of the public that the offender be confined.’</p>
            <p>You do not need to state the test definition but you should be clear that manageability in the community has been considered, assessed and applied.</p>

        </div>
    </details>

    <div class="form-group" data-module="radios">
        <fieldset class="govuk-fieldset govuk-!-margin-bottom-1">
            <legend class="govuk-fieldset__legend govuk-label">
                Does the prisoner require a community RMP?
            </legend>

            @inputRadioGroup(
                reportForm("riskManagementPlanRequired"),
                options(
                    "yes" -> "Yes",
                    "no" -> "No"
                ),
                '_inline -> "true",
                Symbol("data-aria-controls") -> "risk-management-plan"
            )
        </fieldset>

        <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="risk-management-plan-yes">

            @textarea(reportForm("agencies"), '_label -> "Current situation (Agencies)", '_hint -> agenciesHint, 'class -> "wide", 'required -> "true", '_error -> "Enter the current situation (Agencies)")

            <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible govuk-!-margin-top-0"/>

            @textarea(reportForm("support"), '_label -> "Support", '_hint -> supportHint, 'class -> "wide", 'required -> "true", '_error -> "Enter the support")

            <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible govuk-!-margin-top-0"/>

            @textarea(reportForm("control"), '_label -> "Control", '_hint -> controlHint, 'class -> "wide", 'required -> "true", '_error -> "Enter the support")

            <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible govuk-!-margin-top-0"/>

            @textarea(reportForm("riskMeasures"), '_label -> "Added measures for specific risks", '_hint -> riskMeasuresHint, 'class -> "wide", 'required -> "true", '_error -> "Enter the added measures for specific risks")

            <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible govuk-!-margin-top-0"/>

            @textarea(reportForm("agencyActions"), '_label -> "Agency actions", '_hint -> agencyActionsHint, 'class -> "wide", 'required -> "true", '_error -> "Enter the agency actions")

            <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible govuk-!-margin-top-0"/>

            @textarea(reportForm("additionalConditions"), '_label -> "Additional conditions or requirements", '_hint -> additionalConditionsHint, 'class -> "wide", 'required -> "true", '_error -> "Enter the additional conditions or requirements")

            <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible govuk-!-margin-top-0"/>

            @textarea(reportForm("levelOfContact"), '_label -> "Level of contact", '_hint -> levelOfContactHint, 'class -> "wide", 'required -> "true", '_error -> "Enter the level of contact")

            <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible govuk-!-margin-top-0"/>

            @textarea(reportForm("contingencyPlan"), '_label -> "Contingency plan", '_hint -> contingencyPlanHint, 'class -> "wide", 'required -> "true", '_error -> "Enter the contingency plan")

        </div>
    </div>

}
