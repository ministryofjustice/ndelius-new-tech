@import data._
@import helper._
@import shortFormatPreSentenceReport.hiddenInputs._
@import play.Environment
@import com.typesafe.config.Config
@import data.viewModel.PageStatus
@import helpers.CallHelper.relative
@import org.webjars.play.WebJarsUtil
@import menu._
@import fragment._


@(reportForm: Form[ShortFormatPreSentenceReportData], encrypter: String => String)(implicit pageStatuses: Map[Int, PageStatus], webJarsUtil: WebJarsUtil, environment: Environment, configuration: Config)

@implicitField = @{ FieldConstructor(govukElements.f) }

@traumaGuidance = {
    <p>Trauma can affect an offender's ability to engage and make decisions. Detail the offender's experience of trauma. How has it affected their offending? Has it affected their engagement with rehabilitative interventions?</p>
}

@caringResponsibilitiesGuidance = {
    <p>Detail the offender’s current and past caring responsibilities.</p>
    <p class="margin-top">Take account of caring for both children and adults.</p>
    <p class="margin-top">How have those responsibilities affected their offending?</p>
    <p class="margin-top">Have they affected their engagement with rehabilitative interventions?</p>
    <p class="margin-top">Remember that evidence shows that imprisonment of mothers has significant impacts on those that they care for.</p>
}
@main("Offender assessment - Short Format Pre Sentence Report", true, Some(7)) {

    <h1 class="heading-xlarge">Offender assessment</h1>

    <div class="grid-row">
        <div class="column-one-third">

        @navigation(7)

        </div>
        <div class="column-two-thirds">

            @if(!reportForm.allErrors().isEmpty) {
                <div class="error-summary no-margin-top" role="alert" aria-labelledby="error-summary-heading" tabindex="-1">
                    <h2 class="heading-medium error-summary-heading" id="error-summary-heading">There is a problem</h2>

                    <ul class="govuk-list govuk-error-summary__list">
                        @reportForm.allErrors.map(error => <li><a href={s"#${error.key}-error"} class="error-message">{error.format(messages())}</a></li>)
                    </ul>
                </div>
            }

            <h2 class="lede no-margin-top no-margin-bottom">Select the underlying issues that are relevant as motivators or drivers for the main offence</h2>

            <details class="govuk-details govuk-!-margin-top-0 govuk-!-margin-bottom-6 no-margin-top margin-bottom medium">
                <summary class="govuk-details__summary">
                    <span class="govuk-details__summary-text">Offender assessment guidance</span>
                </summary>
                <div class="govuk-details__text panel panel-border-narrow">

                    <p>You should consider diversity issues for each factor in terms of the offender’s own experiences or protected characteristics.</p>
                    <p>Key aspects of the person’s circumstances should be detailed. Those which are linked to their offending behaviour should be highlighted.</p>
                    <p>Make sure that you select all of the factors that have impacted on offending, and that may impact on future risk of re offending.</p>
                    <p>Also, consider if there are factors that are not directly linked. These may cause difficulties for the offender and impact on their desistance from crime.</p>

                </div>
            </details>

            <div class="notice">
                <i class="icon icon-important">
                    <span class="visually-hidden">Warning</span>
                </i>
                <strong class="font-small">
                    By not selecting an issue you are indicating it is not relevant
                </strong>
            </div>

            <p>&nbsp;</p>

            @helper.form(action = relative(routes.ShortFormatPreSentenceReportController.wizardPost()), 'novalidate -> "") {
                @CSRF.formField

                @commonFields(reportForm, encrypter)
                @page2Fields(reportForm, encrypter)
                @page3Fields(reportForm, encrypter)
                @page4Fields(reportForm)
                @page5Fields(reportForm)
                @page6Fields(reportForm)

                <div class="form-group@if(reportForm.allErrors.stream.anyMatch(!_.key.contains("Details"))) { form-group-error}">
                @checkboxDetailsField(reportForm, "issueAccommodation", "Accommodation", "Provide a brief assessment for accommodation", Some("Select underlying issues from the options below"))
                @checkboxDetailsField(reportForm, "issueEmployment", "Employment, training and education", "Provide a brief assessment for employment")
                @checkboxDetailsField(reportForm, "issueFinance", "Finance", "Provide a brief assessment for finance")
                @checkboxDetailsField(reportForm, "issueRelationships", "Relationships", "Provide a brief assessment for relationships")
                @checkboxDetailsField(reportForm, "issueSubstanceMisuse", "Substance misuse", "Provide a brief assessment for substance misuse")
                @checkboxDetailsField(reportForm, "issueHealth", "Physical & mental health", "Provide a brief assessment for physical & mental health")
                @checkboxDetailsField(reportForm, "issueBehaviour", "Thinking & behaviour", "Provide a brief assessment for behaviour")
                @checkboxDetailsField(reportForm, "issueOther", "Other (Please specify below)", "Provide a brief assessment of other issues")
                </div>

                <hr />

                <div class="form-group">
                    <fieldset>
                        <legend class="margin-bottom medium">
                            <span class="form-label-bold">Is there evidence of the offender experiencing trauma?</span>
                        </legend>

                        @inputRadioGroup(
                            reportForm("experienceTrauma"),
                            options(
                                "yes" -> "Yes",
                                "no" -> "No"
                            ),
                            Symbol("_inline") -> "true",
                            Symbol("data-target") -> "experienceTrauma-details",
                            Symbol("data-ignore") -> "no"
                        )
                    </fieldset>

                    <div class="panel panel-border-narrow js-hidden moj-reveal margin-top" id="experienceTrauma-details">
                    @textarea(reportForm("experienceTraumaDetails"), '_label -> "Experience of trauma", '_hint -> traumaGuidance, 'class -> "wide")
                    </div>
                </div>


                <hr />

                <div class="form-group">
                    <fieldset>
                        <legend class="margin-bottom medium">
                            <span class="form-label-bold">Does the offender have caring responsibilities for children or adults, or have they ever had caring responsibilities for children or adults?</span>
                        </legend>

                        @inputRadioGroup(
                            reportForm("caringResponsibilities"),
                            options(
                                "yes" -> "Yes",
                                "no" -> "No"
                            ),
                            Symbol("_inline") -> "true",
                            Symbol("data-target") -> "caringResponsibilities-details",
                            Symbol("data-ignore") -> "no"
                        )
                    </fieldset>

                    <div class="panel panel-border-narrow moj-reveal js-hidden" id="caringResponsibilities-details">
                    @textarea(reportForm("caringResponsibilitiesDetails"), '_label -> "Caring responsibilities", '_hint -> caringResponsibilitiesGuidance, 'class -> "wide")
                    </div>
                </div>

                @page8Fields(reportForm)
                @page9Fields(reportForm)
                @page11Fields(reportForm, encrypter)

                @footer(7, reportForm, encrypter)
            }

        </div>
    </div>
}
